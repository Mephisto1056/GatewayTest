# 组织领导力诊断系统 - 操作与业务流程指南

本文档详细说明了如何使用本系统完成一次完整的领导力评估流程。

---

## 1. 系统角色与权限

*   **Admin (系统管理员)**: 负责用户管理、问卷管理、发布评估任务、查看所有数据。
*   **User (普通用户)**: 
    *   **被评估者**: 参与自评，查看个人报告。
    *   **评估者 (他评)**: 评价他人 (上级、平级、下级)。

---

## 2. 业务全流程概览

一个完整的业务闭环包含以下步骤：

1.  **环境准备**: 启动系统与数据库。
2.  **基础数据**: 导入/创建用户、配置问卷题库。
3.  **发布评估**: 管理员发起评估任务。
4.  **执行评估**: 
    *   被评估者收到通知 -> 填写自评。
    *   评估者收到邮件邀请 -> 填写他评。
5.  **进度监控**: 管理员查看完成情况。
6.  **报告生成**: 评估完成后，生成个人/组织报告。

---

## 3. 详细操作指引

### 步骤 1: 系统启动与初始化

确保后端 (`backend`) 和前端 (`frontend`) 服务都已启动。

```bash
# 后端
cd backend
npm run start:dev

# 前端
cd frontend
npm run dev
```

访问前端地址: `http://localhost:5173`

### 步骤 2: 用户与题库准备 (Admin)

1.  **登录**: 使用管理员账号登录 (`/login`)。
    *   *如果是首次运行，可能需要通过 `npm run seed` 脚本初始化管理员账号。*
2.  **用户管理**:
    *   进入 **"用户管理"** (`/dashboard/users`)。
    *   可以使用 **"批量导入"** 功能上传员工名单 (Excel)，或手动创建用户。
    *   **关键点**: 确保用户的 `Email` 正确，以便接收评估邀请。
3.  **问卷管理**:
    *   进入 **"问卷管理"** (`/dashboard/questions`)。
    *   检查题库是否完整（高层、中层、基层问卷）。系统初始化时通常会通过脚本 (`seed.ts`) 预置标准题库。

### 步骤 3: 发布评估任务 (Admin)

1.  进入 **"评估管理"** (`/dashboard/evaluations`)。
2.  点击 **"新建评估"** 或 **"批量发布"**。
3.  选择需要被评估的员工列表。
4.  设定截止日期。
5.  **点击发布**。
    *   *系统动作*: 
        *   创建评估记录。
        *   自动生成“自评”任务。
        *   根据组织架构自动匹配“他评”人员（上级、平级、下级）。
        *   **发送邮件通知**: 给所有评估者发送邀请邮件（需配置 SMTP）。

### 步骤 4: 参与评估 (User)

**场景 A: 被评估者 (自评)**
1.  用户登录系统 (`/user-dashboard`)。
2.  在 **"我的待办"** 中看到 "自评任务"。
3.  点击 **"开始评估"**，进入问卷填写页面 (`/questionnaire`)。
4.  完成所有题目后提交。

**场景 B: 评估者 (他评)**
1.  收到邮件通知，点击邮件中的链接。
    *   *链接格式*: `http://localhost:5173/evaluation/fill/:participantId`
2.  (如未登录会跳转登录) 进入问卷页面。
3.  针对被评估者进行打分和评价。
4.  提交问卷。

### 步骤 5: 进度监控与报告生成 (Admin/User)

**管理员视角**:
1.  在 **"数据报表"** (`/dashboard/reports`) 中查看整体进度。
2.  当某位用户的评估进度达到 100%（或截止日期已过），点击 **"生成报告"**。
    *   *系统动作*: 调用算法计算得分 -> 生成雷达图/LCP图 -> 调用 AI 生成分析 -> 合成 PDF。
3.  下载 PDF 报告进行存档或打印。

**用户视角**:
1.  报告生成后，用户在 **"我的报告"** (`/my-report`) 中可以看到最新报告。
2.  点击 **"查看"** 在线浏览，或点击 **"下载"** 获取 PDF 版本。

---

## 4. 关键数据流向说明

*   **评分逻辑**: 
    *   系统会自动识别题目是“正向计分”还是“反向计分”。
    *   **360度加权**: 最终得分 = `自评*权重 + 上级*权重 + 平级*权重 + 下级*权重`。
*   **AI 分析**: 
    *   系统将计算出的维度得分和用户的开放性回答发送给 Kimi AI。
    *   AI 返回一段“优势”、“劣势”和“行动建议”的文本，插入到报告中。

## 5. 常见问题排查

*   **收不到邮件?**
    *   检查 `backend/.env` 中的 SMTP 配置是否正确。
    *   检查垃圾邮件箱。
    *   确认接收者邮箱地址是否有效。
*   **报告生成失败?**
    *   检查后端日志，看是否是 AI 接口超时或 PDF 生成库报错。
    *   确保后端 `output/` 目录有写入权限。