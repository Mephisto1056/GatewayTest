# 🔧 故障排除指南

## 🚨 常见问题及解决方案

### 问题1：提交问卷时显示"网络失败并重试"

#### 可能原因：
1. 后端服务未启动
2. 前端代理配置问题
3. 端口冲突
4. API路径不匹配

#### 解决步骤：

##### 步骤1：检查服务状态
```bash
# 检查后端服务（应该在端口3000）
curl http://localhost:3000

# 检查前端服务（应该在端口5173）
curl http://localhost:5173
```

##### 步骤2：使用完整系统测试脚本
```bash
# 使用新的完整测试脚本
./test-full-system.sh
```

##### 步骤3：手动启动服务
```bash
# 终端1：启动后端
cd backend
npm run start:dev

# 终端2：启动前端
cd frontend
npm run dev
```

##### 步骤4：验证API连接
```bash
# 测试问卷获取API
curl "http://localhost:3000/questionnaires/by-role/高层领导者"

# 测试问卷提交API（POST请求）
curl -X POST http://localhost:3000/evaluations/submit-questionnaire \
  -H "Content-Type: application/json" \
  -d '{
    "evaluationId": 1,
    "respondentId": 1,
    "relationship": "自评",
    "responses": [
      {"questionCode": "SD001", "score": 4}
    ]
  }'
```

### 问题2：端口被占用

#### 解决方案：
```bash
# 查看端口占用
lsof -i :3000
lsof -i :5173

# 杀死占用进程
kill -9 <PID>

# 或使用脚本自动清理
./test-full-system.sh  # 脚本会自动清理端口
```

### 问题3：依赖安装问题

#### 解决方案：
```bash
# 清理并重新安装后端依赖
cd backend
rm -rf node_modules package-lock.json
npm install

# 清理并重新安装前端依赖
cd ../frontend
rm -rf node_modules package-lock.json
npm install
```

### 问题4：数据库连接问题

#### 症状：
- 后端启动时报数据库连接错误
- API返回500错误

#### 解决方案：
```bash
# 检查数据库配置
cat backend/.env

# 确保数据库服务运行
# MySQL:
brew services start mysql

# PostgreSQL:
brew services start postgresql

# 或使用Docker:
docker run -d --name test-db -p 3306:3306 -e MYSQL_ROOT_PASSWORD=password mysql:8
```

### 问题5：CORS跨域问题

#### 症状：
- 浏览器控制台显示CORS错误
- 网络请求被阻止

#### 解决方案：
检查后端CORS配置（通常在main.ts中）：
```typescript
app.enableCors({
  origin: 'http://localhost:5173',
  credentials: true,
});
```

## 🔍 调试技巧

### 1. 浏览器开发者工具
- 打开F12开发者工具
- 查看Network标签页
- 检查失败的请求详情
- 查看Console错误信息

### 2. 后端日志
```bash
# 查看后端详细日志
cd backend
npm run start:dev

# 观察控制台输出的错误信息
```

### 3. 前端代理测试
```bash
# 直接测试代理是否工作
curl http://localhost:5173/api/questionnaires/selfdirected
```

### 4. API测试工具
使用Postman或curl测试API：
```bash
# 测试获取问卷
curl -X GET "http://localhost:3000/questionnaires/by-role/高层领导者"

# 测试提交问卷
curl -X POST http://localhost:3000/evaluations/submit-questionnaire \
  -H "Content-Type: application/json" \
  -d @demo-data.json
```

## 📋 检查清单

### 启动前检查：
- [ ] Node.js已安装（v18+）
- [ ] npm可用
- [ ] 端口3000和5173未被占用
- [ ] 数据库服务运行正常

### 运行时检查：
- [ ] 后端服务在http://localhost:3000响应
- [ ] 前端服务在http://localhost:5173响应
- [ ] API代理配置正确
- [ ] 浏览器控制台无错误

### 功能检查：
- [ ] 可以选择不同角色
- [ ] 问卷内容正确加载
- [ ] 可以填写和提交问卷
- [ ] 提交后显示成功信息

## 🆘 获取更多帮助

### 日志文件位置：
- 后端日志：控制台输出
- 前端日志：浏览器开发者工具Console
- 系统日志：检查系统日志文件

### 常用命令：
```bash
# 查看进程
ps aux | grep node

# 查看端口
netstat -tulpn | grep :3000
netstat -tulpn | grep :5173

# 重启服务
pkill -f "node.*backend"
pkill -f "node.*frontend"
```

### 联系支持：
如果问题仍然存在，请提供：
1. 错误信息截图
2. 浏览器控制台日志
3. 后端控制台日志
4. 操作系统信息

## 🎯 快速修复

### 一键重置：
```bash
# 停止所有服务
pkill -f node

# 清理端口
lsof -ti:3000 | xargs kill -9 2>/dev/null
lsof -ti:5173 | xargs kill -9 2>/dev/null

# 重新启动
./test-full-system.sh
```

### 验证修复：
1. 访问 http://localhost:5173
2. 选择角色并填写几道题
3. 点击提交按钮
4. 确认没有网络错误

祝您测试顺利！🚀